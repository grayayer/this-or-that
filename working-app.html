<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>This or That? - Working Version</title>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/responsive.css">
</head>

<body>
	<div class="app-container">
		<header class="app-header">
			<h1>This or That?</h1>
			<p class="app-description">Choose your preferred design in each pair to discover your aesthetic preferences
			</p>
		</header>

		<!-- Loading Section -->
		<section class="loading-section" id="loading-section">
			<div class="loading-container">
				<div class="loading-spinner"></div>
				<p class="loading-text">Loading design options...</p>
			</div>
		</section>

		<!-- Error Section -->
		<section class="error-section" id="error-section" style="display: none;">
			<div class="error-container">
				<h3>Oops! Something went wrong</h3>
				<p class="error-message" id="error-message"></p>
				<button class="btn btn-primary" id="retry-btn" onclick="location.reload()">Try Again</button>
			</div>
		</section>

		<!-- Image Pair Selection Section -->
		<section class="selection-section" id="selection-section" style="display: none;">
			<div class="image-pair-container">
				<div class="image-option" id="image-option-1" onclick="selectImage(1)">
					<img src="" alt="Design option 1" id="image-1" class="design-image">
					<div class="image-overlay">
						<span class="choice-label">Choose This</span>
					</div>
				</div>

				<div class="vs-divider">
					<span>or</span>
				</div>

				<div class="image-option" id="image-option-2" onclick="selectImage(2)">
					<img src="" alt="Design option 2" id="image-2" class="design-image">
					<div class="image-overlay">
						<span class="choice-label">Choose This</span>
					</div>
				</div>
			</div>
		</section>

		<!-- Progress Section -->
		<section class="progress-section" id="progress-section" style="display: none;">
			<div class="progress-container">
				<div class="progress-text" id="progress-text">Choice 1 of 20+</div>
				<div class="progress-bar-container">
					<div class="progress-bar" id="progress-bar"></div>
				</div>
			</div>
		</section>
	</div>

	<script>
		let designs = [];
		let currentPair = [];
		let selections = [];
		let currentRound = 0;

		async function loadData() {
			try {
				console.log('üîÑ Loading data...');
				const response = await fetch('data/sample-designs.json');
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}
				const data = await response.json();
				designs = data.designs;
				console.log(`‚úÖ Loaded ${designs.length} designs`);

				// Hide loading, show selection
				document.getElementById('loading-section').style.display = 'none';
				document.getElementById('selection-section').style.display = 'block';
				document.getElementById('progress-section').style.display = 'block';

				loadNextPair();

			} catch (error) {
				console.error('‚ùå Failed to load data:', error);
				showError('Failed to load design data: ' + error.message);
			}
		}

		function showError(message) {
			document.getElementById('loading-section').style.display = 'none';
			document.getElementById('selection-section').style.display = 'none';
			document.getElementById('error-section').style.display = 'block';
			document.getElementById('error-message').textContent = message;
		}

		function getRandomPair() {
			if (designs.length < 2) return null;

			const shuffled = [...designs].sort(() => Math.random() - 0.5);
			return [shuffled[0], shuffled[1]];
		}

		function loadNextPair() {
			currentPair = getRandomPair();
			if (!currentPair) {
				showError('Not enough designs available');
				return;
			}

			const img1 = document.getElementById('image-1');
			const img2 = document.getElementById('image-2');

			img1.src = currentPair[0].image;
			img1.alt = currentPair[0].title || 'Design option 1';

			img2.src = currentPair[1].image;
			img2.alt = currentPair[1].title || 'Design option 2';

			updateProgress();
		}

		function selectImage(choice) {
			const selectedDesign = currentPair[choice - 1];
			const rejectedDesign = currentPair[choice === 1 ? 1 : 0];

			selections.push({
				selected: selectedDesign,
				rejected: rejectedDesign,
				round: currentRound + 1,
				timestamp: new Date().toISOString()
			});

			currentRound++;

			if (currentRound >= 5) {
				showResults();
			} else {
				loadNextPair();
			}
		}

		function updateProgress() {
			const progressText = document.getElementById('progress-text');
			const progressBar = document.getElementById('progress-bar');

			progressText.textContent = `Choice ${currentRound + 1} of 5`;

			const percentage = ((currentRound) / 5) * 100;
			progressBar.style.width = percentage + '%';
		}

		function showResults() {
			document.getElementById('selection-section').style.display = 'none';
			document.getElementById('progress-section').style.display = 'none';

			const container = document.querySelector('.app-container');
			container.innerHTML += `
                <section class="results-section">
                    <div class="results-container">
                        <h2>Your Choices</h2>
                        <div class="results-list">
                            ${selections.map((sel, i) => `
                                <div class="result-item">
                                    <h3>Choice ${i + 1}</h3>
                                    <p><strong>Selected:</strong> ${sel.selected.title || sel.selected.id}</p>
                                    <p><strong>Rejected:</strong> ${sel.rejected.title || sel.rejected.id}</p>
                                </div>
                            `).join('')}
                        </div>
                        <button class="btn btn-primary" onclick="location.reload()">Start Over</button>
                    </div>
                </section>
            `;
		}

		// Start the app
		document.addEventListener('DOMContentLoaded', loadData);
	</script>

	<style>
		.results-section {
			margin-top: 40px;
		}

		.result-item {
			margin: 20px 0;
			padding: 15px;
			border: 1px solid #e9ecef;
			border-radius: 8px;
		}

		.result-item h3 {
			margin-bottom: 10px;
			color: #0066cc;
		}

		.result-item p {
			margin: 5px 0;
		}
	</style>
</body>

</html>