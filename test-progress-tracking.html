<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Progress Tracking Test</title>
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/responsive.css">
	<style>
		.test-controls {
			background: #f8f9fa;
			padding: 20px;
			border-radius: 8px;
			margin: 20px 0;
			text-align: center;
		}

		.test-controls button {
			margin: 5px;
			padding: 10px 20px;
			background: #007bff;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
		}

		.test-controls button:hover {
			background: #0056b3;
		}

		.test-info {
			background: #e9ecef;
			padding: 15px;
			border-radius: 8px;
			margin: 10px 0;
		}
	</style>
</head>

<body>
	<main class="app-container">
		<header class="app-header">
			<h1>Progress Tracking Test</h1>
			<p class="app-description">Testing the progress tracking and display functionality</p>
		</header>

		<!-- Test Controls -->
		<div class="test-controls">
			<button onclick="initializeTest()">Initialize App</button>
			<button onclick="simulateSelection()">Simulate Selection</button>
			<button onclick="simulateMultipleSelections(5)">+5 Selections</button>
			<button onclick="simulateMultipleSelections(10)">+10 Selections</button>
			<button onclick="resetTest()">Reset</button>
		</div>

		<!-- Test Info -->
		<div class="test-info" id="test-info">
			<p>Click "Initialize App" to start, then use "Simulate Selection" to test progress tracking.</p>
		</div>

		<!-- Progress Section -->
		<section class="progress-section" id="progress-section">
			<div class="progress-container">
				<div class="progress-text" id="progress-text">Choice 0 of 20</div>
				<div class="progress-bar-container">
					<div class="progress-bar" id="progress-bar"></div>
				</div>
			</div>
		</section>

		<!-- Continue Section (will be created dynamically) -->

		<!-- Mock Selection Section -->
		<section class="selection-section" id="selection-section">
			<div class="image-pair-container">
				<div class="image-option" id="image-option-1">
					<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZTNmMmZkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzMzNzNkYyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkRlc2lnbiBBPC90ZXh0Pjwvc3ZnPg=="
						alt="Design A" id="image-1" class="design-image">
					<div class="image-overlay">
						<span class="choice-label">Choose This</span>
					</div>
				</div>

				<div class="vs-divider">
					<span>or</span>
				</div>

				<div class="image-option" id="image-option-2">
					<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZmVmM2UyIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iI2Y1OTIwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkRlc2lnbiBCPC90ZXh0Pjwvc3ZnPg=="
						alt="Design B" id="image-2" class="design-image">
					<div class="image-overlay">
						<span class="choice-label">Choose This</span>
					</div>
				</div>
			</div>
		</section>

		<!-- Results Section -->
		<section class="results-section" id="results-section" style="display: none;">
			<div class="results-container">
				<!-- Results content will be populated dynamically -->
			</div>
		</section>

	</main>

	<!-- Scripts -->
	<script src="js/data-validator.js"></script>
	<script src="js/app-data-loader.js"></script>
	<script src="js/app.js"></script>

	<script>
		let testInitialized = false;

		function updateTestInfo(message) {
			const testInfo = document.getElementById('test-info');
			testInfo.innerHTML = `<p>${message}</p>`;
		}

		async function initializeTest() {
			try {
				updateTestInfo('Initializing app...');

				await initializeApp({
					dataPath: 'data/sample-designs.json',
					enableLogging: true
				});

				testInitialized = true;
				updateTestInfo('‚úÖ App initialized! Use "Simulate Selection" to test progress tracking.');

				// Set up mock image data
				const option1 = document.getElementById('image-option-1');
				const option2 = document.getElementById('image-option-2');
				option1.dataset.designId = 'test-design-1';
				option2.dataset.designId = 'test-design-2';

				// Set up mock current pair
				appState.currentPair = [
					{ id: 'test-design-1', image: 'test1.jpg', tags: { style: ['Modern'] } },
					{ id: 'test-design-2', image: 'test2.jpg', tags: { style: ['Classic'] } }
				];

				// Update initial progress display
				updateProgressDisplay();

			} catch (error) {
				updateTestInfo(`‚ùå Initialization failed: ${error.message}`);
			}
		}

		function simulateSelection() {
			if (!testInitialized) {
				updateTestInfo('‚ùå Please initialize the app first');
				return;
			}

			try {
				// Simulate selecting the first design
				const success = handleSelection('test-design-1');

				if (success) {
					const status = getAppStatus();
					updateTestInfo(`‚úÖ Selection ${status.totalRounds} recorded. Progress: ${status.progressPercentage.toFixed(1)}%`);

					// Update mock pair for next selection
					appState.currentPair = [
						{ id: `test-design-${status.totalRounds + 1}`, image: 'test1.jpg', tags: { style: ['Modern'] } },
						{ id: `test-design-${status.totalRounds + 2}`, image: 'test2.jpg', tags: { style: ['Classic'] } }
					];
				} else {
					updateTestInfo('‚ùå Selection failed');
				}
			} catch (error) {
				updateTestInfo(`‚ùå Selection error: ${error.message}`);
			}
		}

		function simulateMultipleSelections(count) {
			if (!testInitialized) {
				updateTestInfo('‚ùå Please initialize the app first');
				return;
			}

			for (let i = 0; i < count; i++) {
				setTimeout(() => {
					simulateSelection();
				}, i * 100); // Small delay between selections
			}
		}

		function resetTest() {
			try {
				resetApplicationState();
				testInitialized = false;
				updateTestInfo('üîÑ Test reset. Click "Initialize App" to start again.');

				// Hide continue and results sections
				const continueSection = document.getElementById('continue-section');
				const resultsSection = document.getElementById('results-section');

				if (continueSection) {
					continueSection.style.display = 'none';
				}
				if (resultsSection) {
					resultsSection.style.display = 'none';
				}

				// Show selection section
				const selectionSection = document.getElementById('selection-section');
				if (selectionSection) {
					selectionSection.style.display = 'block';
				}

			} catch (error) {
				updateTestInfo(`‚ùå Reset error: ${error.message}`);
			}
		}

		// Set up click handlers for image options
		document.addEventListener('DOMContentLoaded', function () {
			const option1 = document.getElementById('image-option-1');
			const option2 = document.getElementById('image-option-2');

			if (option1) {
				option1.addEventListener('click', () => {
					if (testInitialized) {
						handleSelection('test-design-1');
					}
				});
			}

			if (option2) {
				option2.addEventListener('click', () => {
					if (testInitialized) {
						handleSelection('test-design-2');
					}
				});
			}
		});
	</script>
</body>

</html>