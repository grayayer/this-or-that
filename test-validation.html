<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Data Validation Test - This or That App</title>
	<style>
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
			line-height: 1.6;
		}

		.test-section {
			background: #f8f9fa;
			border-radius: 8px;
			padding: 20px;
			margin: 20px 0;
		}

		.success {
			color: #28a745;
		}

		.error {
			color: #dc3545;
		}

		.warning {
			color: #ffc107;
		}

		.info {
			color: #17a2b8;
		}

		pre {
			background: #f1f3f4;
			padding: 15px;
			border-radius: 4px;
			overflow-x: auto;
			font-size: 14px;
		}

		button {
			background: #007bff;
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 4px;
			cursor: pointer;
			margin: 5px;
		}

		button:hover {
			background: #0056b3;
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 15px;
			margin: 15px 0;
		}

		.stat-card {
			background: white;
			padding: 15px;
			border-radius: 6px;
			border: 1px solid #dee2e6;
		}

		.pair-display {
			display: flex;
			gap: 20px;
			margin: 10px 0;
			flex-wrap: wrap;
		}

		.design-card {
			border: 1px solid #ddd;
			border-radius: 6px;
			padding: 10px;
			max-width: 300px;
		}

		.design-image {
			width: 100%;
			height: 150px;
			background: #f0f0f0;
			border-radius: 4px;
			display: flex;
			align-items: center;
			justify-content: center;
			color: #666;
			font-size: 14px;
		}
	</style>
</head>

<body>
	<h1>🧪 Data Validation & Loading Test</h1>
	<p>This page tests the JSON validation and data loading functionality for the This or That application.</p>

	<div class="test-section">
		<h2>📊 Data Loading Test</h2>
		<button onclick="loadSampleData()">Load Sample Data</button>
		<button onclick="loadScrapedData()">Load Scraped Data</button>
		<button onclick="testValidation()">Test Validation</button>
		<div id="loadingResults"></div>
	</div>

	<div class="test-section">
		<h2>📈 Data Statistics</h2>
		<div id="dataStats"></div>
	</div>

	<div class="test-section">
		<h2>🎲 Random Pair Generation</h2>
		<button onclick="generatePairs()">Generate Random Pairs</button>
		<div id="pairResults"></div>
	</div>

	<div class="test-section">
		<h2>🔍 Tag Filtering Test</h2>
		<button onclick="testFiltering()">Test Tag Filtering</button>
		<div id="filterResults"></div>
	</div>

	<!-- Include the validation and data loading scripts -->
	<script src="js/data-validator.js"></script>
	<script src="js/app-data-loader.js"></script>

	<script>
		let dataLoader = null;

		async function loadSampleData() {
			const resultsDiv = document.getElementById('loadingResults');
			resultsDiv.innerHTML = '<p class="info">🔄 Loading sample data...</p>';

			try {
				dataLoader = new AppDataLoader();
				const data = await dataLoader.loadDesigns('data/sample-designs.json');

				resultsDiv.innerHTML = `
                    <p class="success">✅ Successfully loaded ${data.designs.length} sample designs</p>
                    <p class="info">📊 Metadata: Generated at ${data.metadata.generatedAt}</p>
                `;

				updateDataStats();

			} catch (error) {
				resultsDiv.innerHTML = `<p class="error">❌ Error: ${error.message}</p>`;
			}
		}

		async function loadScrapedData() {
			const resultsDiv = document.getElementById('loadingResults');
			resultsDiv.innerHTML = '<p class="info">🔄 Loading scraped data...</p>';

			try {
				dataLoader = new AppDataLoader();
				const data = await dataLoader.loadDesigns('data/designs.json');

				resultsDiv.innerHTML = `
                    <p class="success">✅ Successfully loaded ${data.designs.length} scraped designs</p>
                    <p class="info">📊 Source: ${data.metadata.source}</p>
                    <p class="info">🧹 Validation errors: ${data.metadata.validationErrors || 0}</p>
                    <p class="info">⚠️ Validation warnings: ${data.metadata.validationWarnings || 0}</p>
                `;

				updateDataStats();

			} catch (error) {
				resultsDiv.innerHTML = `<p class="error">❌ Error: ${error.message}</p>`;
			}
		}

		function testValidation() {
			const resultsDiv = document.getElementById('loadingResults');

			const validator = new DataValidator();
			const testCases = validator.createTestCases();

			let results = '<h3>🧪 Validation Test Results</h3>';

			testCases.forEach((testCase, index) => {
				const result = validator.validateDesignsData(testCase.data);
				const passed = result.isValid === testCase.expectedValid;

				results += `
                    <div style="margin: 10px 0; padding: 10px; border-left: 3px solid ${passed ? '#28a745' : '#dc3545'};">
                        <strong>${testCase.name}</strong><br>
                        Expected: ${testCase.expectedValid}, Got: ${result.isValid}
                        ${passed ? '<span class="success">✅</span>' : '<span class="error">❌</span>'}<br>
                        Errors: ${result.errors.length}, Warnings: ${result.warnings.length}
                    </div>
                `;
			});

			resultsDiv.innerHTML = results;
		}

		function updateDataStats() {
			if (!dataLoader || !dataLoader.isReady()) {
				return;
			}

			const stats = dataLoader.getDataStats();
			const statsDiv = document.getElementById('dataStats');

			statsDiv.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>📊 Overview</h4>
                        <p>Total Designs: <strong>${stats.totalDesigns}</strong></p>
                        <p>Unique Authors: <strong>${stats.uniqueAuthors}</strong></p>
                        <p>Avg Colors/Design: <strong>${stats.averageColorsPerDesign.toFixed(1)}</strong></p>
                    </div>
                    <div class="stat-card">
                        <h4>🎨 Style Tags</h4>
                        <p>Unique: <strong>${stats.tagStats.style.unique}</strong></p>
                        <p>Most Common:</p>
                        <ul>
                            ${stats.tagStats.style.mostCommon.slice(0, 3).map(tag =>
				`<li>${tag.tag} (${tag.count})</li>`
			).join('')}
                        </ul>
                    </div>
                    <div class="stat-card">
                        <h4>🏢 Industry Tags</h4>
                        <p>Unique: <strong>${stats.tagStats.industry.unique}</strong></p>
                        <p>Most Common:</p>
                        <ul>
                            ${stats.tagStats.industry.mostCommon.slice(0, 3).map(tag =>
				`<li>${tag.tag} (${tag.count})</li>`
			).join('')}
                        </ul>
                    </div>
                    <div class="stat-card">
                        <h4>⚙️ Platform Tags</h4>
                        <p>Unique: <strong>${stats.tagStats.platform.unique}</strong></p>
                        <p>Most Common:</p>
                        <ul>
                            ${stats.tagStats.platform.mostCommon.slice(0, 3).map(tag =>
				`<li>${tag.tag} (${tag.count})</li>`
			).join('')}
                        </ul>
                    </div>
                </div>
            `;
		}

		function generatePairs() {
			if (!dataLoader || !dataLoader.isReady()) {
				document.getElementById('pairResults').innerHTML =
					'<p class="error">❌ Please load data first</p>';
				return;
			}

			const usedPairs = new Set();
			const pairs = dataLoader.getRandomPairs(3, usedPairs);

			let pairHtml = `<p class="success">✅ Generated ${pairs.length} random pairs:</p>`;

			pairs.forEach((pair, index) => {
				pairHtml += `
                    <div class="pair-display">
                        <div class="design-card">
                            <div class="design-image">Design Image</div>
                            <h4>${pair[0].title || pair[0].id}</h4>
                            <p><strong>Style:</strong> ${pair[0].tags.style.slice(0, 2).join(', ')}</p>
                            <p><strong>Industry:</strong> ${pair[0].tags.industry.slice(0, 2).join(', ')}</p>
                        </div>
                        <div style="display: flex; align-items: center; font-size: 24px;">VS</div>
                        <div class="design-card">
                            <div class="design-image">Design Image</div>
                            <h4>${pair[1].title || pair[1].id}</h4>
                            <p><strong>Style:</strong> ${pair[1].tags.style.slice(0, 2).join(', ')}</p>
                            <p><strong>Industry:</strong> ${pair[1].tags.industry.slice(0, 2).join(', ')}</p>
                        </div>
                    </div>
                `;
			});

			document.getElementById('pairResults').innerHTML = pairHtml;
		}

		function testFiltering() {
			if (!dataLoader || !dataLoader.isReady()) {
				document.getElementById('filterResults').innerHTML =
					'<p class="error">❌ Please load data first</p>';
				return;
			}

			const techDesigns = dataLoader.getDesignsByTags({ industry: ['Tech'] });
			const modernDesigns = dataLoader.getDesignsByTags({ style: ['Modern', 'Clean'] });
			const techModernDesigns = dataLoader.getDesignsByTags({
				industry: ['Tech'],
				style: ['Modern', 'Clean']
			});

			document.getElementById('filterResults').innerHTML = `
                <p class="success">✅ Filtering test results:</p>
                <ul>
                    <li><strong>Tech industry:</strong> ${techDesigns.length} designs</li>
                    <li><strong>Modern/Clean style:</strong> ${modernDesigns.length} designs</li>
                    <li><strong>Tech + Modern/Clean:</strong> ${techModernDesigns.length} designs</li>
                </ul>

                <h4>Sample Tech Designs:</h4>
                <div style="max-height: 200px; overflow-y: auto;">
                    ${techDesigns.slice(0, 5).map(design => `
                        <div style="border: 1px solid #ddd; margin: 5px 0; padding: 10px; border-radius: 4px;">
                            <strong>${design.title || design.id}</strong><br>
                            <small>Style: ${design.tags.style.join(', ')}</small><br>
                            <small>Industry: ${design.tags.industry.join(', ')}</small>
                        </div>
                    `).join('')}
                </div>
            `;
		}

		// Initialize page
		document.addEventListener('DOMContentLoaded', function () {
			console.log('🚀 Data validation test page loaded');
			console.log('📋 Available functions: loadSampleData(), loadScrapedData(), testValidation()');
		});
	</script>
</body>

</html>