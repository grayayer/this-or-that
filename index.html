<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>This or That? - Design Preference Discovery</title>
	<meta name="description"
		content="Discover your design preferences through quick binary choices between web design screenshots">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/responsive.css">
	<link rel="stylesheet" href="css/print.css">
</head>

<body>
	<!-- Main Application Container -->
	<main class="app-container">

		<!-- Header Section -->
		<header class="app-header">
			<h1>This or That?</h1>
			<p class="app-description">Choose your preferred web design in each pair to discover your aesthetic
				preferences.
			</p>
		</header>

		<!-- Instructions Section -->
		<section class="instructions-section" id="instructions-section">
			<div class="instructions-container">
				<h2>How to Use</h2>
				<div class="instructions-grid">
					<div class="instruction-item">
						<div class="instruction-icon">‚å®Ô∏è</div>
						<div class="instruction-content">
							<h3>Keyboard Shortcuts</h3>
							<p>Press <kbd>1</kbd> for left option, <kbd>2</kbd> for right option, or <kbd>Spacebar</kbd>
								to skip</p>
							<p style="margin-top: 10px;">This is recommended over usage of the mouse for expediency and
								accuracy</p>
						</div>
					</div>
					<div class="instruction-item">
						<div class="instruction-icon">üëÜ</div>
						<div class="instruction-content">
							<h3>Click or Tap</h3>
							<p>Click or tap on your preferred design from each pair</p>
						</div>
					</div>
					<div class="instruction-item">
						<div class="instruction-icon">‚è±Ô∏è</div>
						<div class="instruction-content">
							<h3>Quick Decisions</h3>
							<p>You have <span id="timer-duration-display">15</span> seconds per choice - trust your
								instincts!</p>
							<div class="timer-config">
								<label for="timer-duration-slider" class="timer-config-label">
									Adjust timer duration:
								</label>
								<div class="timer-slider-container">
									<input type="range" id="timer-duration-slider" class="timer-slider" min="15"
										max="60" value="15" step="5">
									<div class="timer-slider-labels">
										<span>15s</span>
										<span>30s</span>
										<span>45s</span>
										<span>60s</span>
									</div>
								</div>
								<div class="timer-disable-option">
									<label class="timer-checkbox-label">
										<input type="checkbox" id="timer-disable-checkbox" class="timer-checkbox">
										<span class="timer-checkbox-text">Disable timer (no time limit)</span>
									</label>
								</div>
							</div>
						</div>
					</div>
					<div class="instruction-item">
						<div class="instruction-icon">üìä</div>
						<div class="instruction-content">
							<h3>Get Results</h3>
							<p>Complete at least 20 choices to see your web design preference profile</p>
						</div>
					</div>
				</div>
				<div class="instructions-actions">
					<button class="btn btn-primary" id="start-app-btn">Start Discovering</button>
				</div>
			</div>
		</section>

		<!-- Timer Section -->
		<section class="timer-section" id="timer-section">
			<div class="timer-container">
				<div class="timer-progress-bar" id="timer-progress-bar"></div>
				<div class="timer-display" id="timer-display">15</div>
			</div>
			<div class="keyboard-hints">
				<span class="keyboard-hint"><kbd>1</kbd> Left</span>
				<span class="keyboard-hint"><kbd>2</kbd> Right</span>
				<span class="keyboard-hint"><kbd>Space</kbd> Skip</span>
			</div>
		</section>

		<!-- Progress Section -->
		<section class="progress-section" id="progress-section">
			<div class="progress-container">
				<div class="progress-text" id="progress-text">Choice 1 of 20+</div>
				<div class="progress-bar-container">
					<div class="progress-bar" id="progress-bar"></div>
				</div>
			</div>
		</section>

		<!-- Image Pair Selection Section -->
		<section class="selection-section" id="selection-section">
			<div class="image-pair-container">
				<div class="image-option" id="image-option-1">
					<img src="" alt="Design option 1" id="image-1" class="design-image">
					<div class="image-overlay">
						<span class="choice-label">Choose This</span>
					</div>
				</div>

				<div class="vs-divider">
					<span>or</span>
				</div>

				<div class="image-option" id="image-option-2">
					<img src="" alt="Design option 2" id="image-2" class="design-image">
					<div class="image-overlay">
						<span class="choice-label">Choose This</span>
					</div>
				</div>
			</div>

			<!-- Skip Options -->
			<div class="skip-options" id="skip-options">
				<button class="skip-btn dislike-both-btn" id="dislike-both-btn" title="Mark both designs as disliked">
					üëéüëé Dislike Both
				</button>
				<button class="skip-btn cant-decide-btn" id="cant-decide-btn"
					title="Skip this pair and show it again later">
					ü§î Can't Decide - Show Later
				</button>
			</div>
		</section>

		<!-- Loading Section -->
		<section class="loading-section" id="loading-section">
			<div class="loading-container">
				<div class="loading-spinner"></div>
				<p class="loading-text">Loading design options...</p>
			</div>
		</section>

		<!-- Results Section -->
		<section class="results-section" id="results-section" style="display: none;">
			<div class="results-container">
				<!-- Print-only header -->
				<header class="print-header print-only">
					<h1 class="print-title">This or That?</h1>
					<p class="print-subtitle">Design Preference Discovery Report</p>
					<p class="print-date" id="print-date"></p>
				</header>

				<header class="results-header">
					<h2>Your Design Preferences</h2>
					<p class="results-description">Based on your choices, here's your design preference profile</p>
				</header>

				<div class="results-content">
					<div class="preference-categories" id="preference-categories">
						<!-- Dynamic content will be inserted here -->
					</div>

					<div class="results-actions">
						<button class="btn btn-primary" id="print-results-btn">Print / Save as PDF</button>
						<button class="btn btn-secondary" id="refine-preferences-btn">Refine Preferences</button>
						<button class="btn btn-secondary" id="clear-favorites-btn">Clear Favorites</button>
						<button class="btn btn-secondary" id="start-over-btn">Start Over</button>
						<!-- Email functionality hidden for now -->
						<button class="btn btn-primary" id="email-results-btn" style="display: none;">Email
							Results</button>
					</div>

					<div class="print-instructions screen-only"
						style="text-align: center; margin-top: 20px; padding: 16px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
						<p style="margin: 0; color: #666; font-size: 14px;">
							<strong>üí° Sharing Tip:</strong> Click "Print / Save as PDF" to create a shareable file of
							your design preferences.
							In the print dialog, choose "Save as PDF" as your destination.
						</p>
					</div>
				</div>

				<!-- Print-only footer -->
				<footer class="print-footer print-only">
					<p><strong>Generated by This or That? - Design Preference Discovery Tool</strong></p>
					<p>Design images courtesy of <a href="https://land-book.com">Land-book.com</a></p>
					<p>Report generated on <span id="print-footer-date"></span></p>
					<p style="margin-top: 10pt; font-style: italic; color: #666;">
						üí° Tip: Save this as a PDF to easily share your design preferences with others
					</p>
				</footer>
			</div>
		</section>

		<!-- Email Form Section -->
		<section class="email-section" id="email-section" style="display: none;">
			<div class="email-container">
				<header class="email-header">
					<h3>Share Your Results</h3>
					<p>Send your design preference profile via email</p>
				</header>

				<form class="email-form" id="email-form">
					<div class="form-group">
						<label for="user-email">Your Email Address</label>
						<input type="email" id="user-email" name="userEmail" required placeholder="your@email.com">
					</div>

					<div class="form-group">
						<label for="designer-email">Designer's Email (Optional)</label>
						<input type="email" id="designer-email" name="designerEmail" placeholder="designer@email.com">
					</div>

					<div class="form-actions">
						<button type="submit" class="btn btn-primary">Send Results</button>
						<button type="button" class="btn btn-secondary" id="cancel-email-btn">Cancel</button>
					</div>
				</form>

				<div class="email-status" id="email-status"></div>
			</div>
		</section>

		<!-- Error Section -->
		<section class="error-section" id="error-section" style="display: none;">
			<div class="error-container">
				<h3>Oops! Something went wrong</h3>
				<p class="error-message" id="error-message"></p>
				<button class="btn btn-primary" id="retry-btn">Try Again</button>
			</div>
		</section>

	</main>

	<!-- Footer -->
	<footer class="app-footer">
		<p>Design images courtesy of <a href="https://land-book.com" target="_blank" rel="noopener">Land-book.com</a>
		</p>
		<p>This or That v0.6.3 ‚Ä¢ Built by <a href="https://studiok40.com" target="_blank" rel="noopener">Gray Ayer</a>
		</p>
	</footer>

	<!-- Scripts -->
	<!-- EmailJS CDN for email functionality -->
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

	<!-- Performance optimizations -->
	<script src="js/image-optimizer.js?v=1"></script>
	<script src="js/data-validator.js?v=1"></script>
	<script src="js/app-data-loader.js?v=1"></script>
	<script src="js/favorites-manager.js?v=1"></script>
	<script src="js/results.js?v=1"></script>
	<script src="js/app.js?v=1"></script>
	<script src="js/timer-config.js?v=1"></script>
	<script src="js/timer.js?v=1"></script>
	<script src="js/email.js?v=1"></script>
	<script src="js/print.js?v=1"></script>

	<!-- Clear any cached error states immediately -->
	<script>
		// Clear error states immediately on page load
		document.addEventListener('DOMContentLoaded', function () {
			const errorSection = document.getElementById('error-section');
			if (errorSection) {
				errorSection.style.display = 'none';
				errorSection.innerHTML = '';
			}
		});
	</script>

	<!-- Initialize Application -->
	<script>
		// Initialize the application when DOM is loaded
		document.addEventListener('DOMContentLoaded', async function () {
			try {
				console.log('üöÄ Starting This or That application...');

				// Service worker disabled - caused image loading issues during development
				// Performance optimizations now focus on image optimization and smooth animations

				// Initialize performance monitoring
				initializePerformanceMonitoring();

				// Clear any previous UI states first
				if (typeof clearAllUIStates === 'function') {
					clearAllUIStates();
				}

				// Initialize the app with sample data
				await initializeApp({
					dataPath: 'data/designs.json',
					fallbackDataPath: 'data/sample-designs.json',
					enableLogging: true
				});

				// Hide any previous error states on successful initialization
				if (typeof hideErrorState === 'function') {
					hideErrorState();
				}

				// Initialize the timer component
				setupTimerIntegration();

				// Initialize the image pair selection system
				initializeImagePairSystem();

				// Set up network monitoring
				setupNetworkMonitoring();

			} catch (error) {
				console.error('‚ùå Failed to initialize application:', error);

				// Hide loading state
				if (typeof hideLoadingState === 'function') {
					hideLoadingState();
				}

				// Determine error type and show appropriate message
				const isOffline = typeof navigator !== 'undefined' && !navigator.onLine;
				const errorMessage = error.message || 'Failed to load the application. Please try again.';

				if (typeof showEnhancedErrorState === 'function') {
					showEnhancedErrorState(errorMessage, {
						showRetryButton: true,
						showRefreshButton: true,
						showOfflineMessage: isOffline,
						retryCallback: async () => {
							try {
								if (typeof hideErrorState === 'function') {
									hideErrorState();
								}

								await initializeApp({
									dataPath: 'data/designs.json',
									fallbackDataPath: 'data/sample-designs.json',
									enableLogging: true
								});

								// Re-initialize components if successful
								setupTimerIntegration();
								initializeImagePairSystem();

							} catch (retryError) {
								if (typeof showEnhancedErrorState === 'function') {
									showEnhancedErrorState(
										retryError.message || 'Retry failed. Please refresh the page.',
										{ showRetryButton: false, showRefreshButton: true }
									);
								}
							}
						}
					});
				} else {
					// Fallback to basic error display
					const errorSection = document.getElementById('error-section');
					const errorMessageElement = document.getElementById('error-message');
					const loadingSection = document.getElementById('loading-section');

					if (errorSection && errorMessageElement) {
						errorMessageElement.textContent = errorMessage;
						errorSection.style.display = 'block';
					}

					if (loadingSection) {
						loadingSection.style.display = 'none';
					}
				}
			}
		});

		// Service Worker Registration - DISABLED
		// Service worker caused image loading issues and development complexity
		// Performance optimizations now focus on image optimization and CSS animations

		// Performance Monitoring
		function initializePerformanceMonitoring() {
			// Monitor Core Web Vitals
			if ('web-vital' in window) {
				// This would require web-vitals library, but we'll implement basic monitoring
				console.log('üìä Performance monitoring initialized');
			}

			// Monitor resource loading
			if ('PerformanceObserver' in window) {
				const observer = new PerformanceObserver((list) => {
					for (const entry of list.getEntries()) {
						if (entry.entryType === 'navigation') {
							console.log('üìà Navigation timing:', {
								domContentLoaded: entry.domContentLoadedEventEnd - entry.domContentLoadedEventStart,
								loadComplete: entry.loadEventEnd - entry.loadEventStart
							});
						}
					}
				});

				try {
					observer.observe({ entryTypes: ['navigation', 'resource'] });
				} catch (error) {
					console.warn('‚ö†Ô∏è Performance observer not supported:', error);
				}
			}

			// Monitor memory usage if available
			if ('memory' in performance) {
				setInterval(() => {
					const memory = performance.memory;
					if (memory.usedJSHeapSize > memory.jsHeapSizeLimit * 0.9) {
						console.warn('‚ö†Ô∏è High memory usage detected');
					}
				}, 30000); // Check every 30 seconds
			}
		}

		// Update notification function removed - no longer needed without service worker

		// Set up retry button
		document.addEventListener('DOMContentLoaded', function () {
			const retryBtn = document.getElementById('retry-btn');
			if (retryBtn) {
				retryBtn.addEventListener('click', function () {
					location.reload();
				});
			}
		});
	</script>
</body>

</html>