<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Progress Section Test</title>
	<link rel="stylesheet" href="css/main.css">
	<style>
		body {
			padding: 20px;
			font-family: system-ui;
		}

		.test-section {
			margin: 20px 0;
			padding: 20px;
			border: 1px solid #ccc;
			border-radius: 8px;
		}

		.btn {
			margin: 5px;
			padding: 10px 15px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		.btn-primary {
			background: #0066cc;
			color: white;
		}

		.btn-secondary {
			background: #6c757d;
			color: white;
		}

		.status {
			padding: 10px;
			margin: 10px 0;
			border-radius: 4px;
		}

		.success {
			background: #d4edda;
			color: #155724;
		}

		.info {
			background: #e3f2fd;
			color: #1565c0;
		}
	</style>
</head>

<body>
	<h1>Progress Section Visibility Test</h1>
	<p>This tests the progress section visibility during continue prompts.</p>

	<div class="test-section">
		<h2>Simulate App State</h2>
		<button class="btn btn-primary" onclick="simulateSession1Complete()">Simulate Session 1 Complete (20
			choices)</button>
		<button class="btn btn-primary" onclick="simulateSession2Progress()">Simulate Session 2 Progress (25
			choices)</button>
		<button class="btn btn-primary" onclick="simulateSession2Complete()">Simulate Session 2 Complete (40
			choices)</button>
		<button class="btn btn-secondary" onclick="showContinuePrompt()">Show Continue Prompt</button>
		<button class="btn btn-secondary" onclick="hideContinuePrompt()">Hide Continue Prompt</button>
	</div>

	<div class="test-section">
		<h2>Progress Section</h2>
		<!-- Progress Section -->
		<section class="progress-section" id="progress-section">
			<div class="progress-container">
				<div class="progress-text" id="progress-text">Choice 1 of 20+</div>
				<div class="progress-bar-container">
					<div class="progress-bar" id="progress-bar"></div>
				</div>
			</div>
		</section>
	</div>

	<div class="test-section">
		<h2>Continue Prompt</h2>
		<!-- Continue Section (hidden by default) -->
		<section id="continue-section" style="display: none; padding: 20px; background: #f8f9fa; border-radius: 8px;">
			<h3>Great Progress!</h3>
			<p>You've completed 20 choices! Would you like to make 20 more choices for better results, or see your
				current preferences?</p>
			<div>
				<button class="btn btn-primary" onclick="handleContinue()">Continue with 20 More</button>
				<button class="btn btn-secondary" onclick="handleShowResults()">Show My Results</button>
			</div>
		</section>
	</div>

	<div class="test-section">
		<h2>Test Status</h2>
		<div id="status"></div>
	</div>

	<script>
		// Mock app state
		window.appState = {
			totalRounds: 20,
			currentSession: 1,
			minChoicesRequired: 20,
			isShowingContinuePrompt: false
		};

		function log(message, type = 'info') {
			const statusDiv = document.getElementById('status');
			const div = document.createElement('div');
			div.className = `status ${type}`;
			div.textContent = new Date().toLocaleTimeString() + ': ' + message;
			statusDiv.appendChild(div);
			console.log(message);
		}

		function updateProgressDisplay() {
			const progressText = document.getElementById('progress-text');
			const progressBar = document.getElementById('progress-bar');
			const progressContainer = document.getElementById('progress-section');

			if (progressText) {
				const remaining = Math.max(0, appState.minChoicesRequired - appState.totalRounds);

				if (appState.totalRounds < appState.minChoicesRequired) {
					progressText.textContent = `Choice ${appState.totalRounds} of ${appState.minChoicesRequired} (${remaining} more needed for results)`;
				} else {
					const currentSessionTarget = appState.currentSession * 20;
					const isAtSessionEnd = appState.totalRounds % 20 === 0;

					if (appState.currentSession === 1 && isAtSessionEnd) {
						progressText.textContent = `Choice ${appState.totalRounds} completed - Results available!`;
					} else if (appState.currentSession > 1 && appState.totalRounds < currentSessionTarget) {
						const remaining = currentSessionTarget - appState.totalRounds;
						progressText.textContent = `Choice ${appState.totalRounds} of ${currentSessionTarget} (${remaining} more for next milestone)`;
					} else if (appState.currentSession > 1 && isAtSessionEnd) {
						progressText.textContent = `Choice ${appState.totalRounds} completed - Results available!`;
					} else {
						progressText.textContent = `Choice ${appState.totalRounds} completed`;
					}
				}
			}

			if (progressBar) {
				const currentSessionTarget = appState.currentSession * 20;
				const sessionStart = (appState.currentSession - 1) * 20;
				const sessionProgress = appState.totalRounds - sessionStart;
				const percentage = Math.min(100, (sessionProgress / 20) * 100);

				progressBar.style.setProperty('--progress', `${percentage}%`);

				const isAtSessionEnd = appState.totalRounds % 20 === 0 && appState.totalRounds >= appState.minChoicesRequired;
				if (isAtSessionEnd) {
					progressBar.classList.add('threshold-reached');
				} else {
					progressBar.classList.remove('threshold-reached');
				}
			}

			if (progressContainer) {
				const isAtSessionEnd = appState.totalRounds % 20 === 0 && appState.totalRounds >= appState.minChoicesRequired;
				if (isAtSessionEnd) {
					progressContainer.classList.add('results-available');
				} else {
					progressContainer.classList.remove('results-available');
				}
			}
		}

		function simulateSession1Complete() {
			appState.totalRounds = 20;
			appState.currentSession = 1;
			updateProgressDisplay();
			log('âœ… Simulated Session 1 Complete (20 choices)', 'success');
		}

		function simulateSession2Progress() {
			appState.totalRounds = 25;
			appState.currentSession = 2;
			updateProgressDisplay();
			log('âœ… Simulated Session 2 Progress (25 choices)', 'success');
		}

		function simulateSession2Complete() {
			appState.totalRounds = 40;
			appState.currentSession = 2;
			updateProgressDisplay();
			log('âœ… Simulated Session 2 Complete (40 choices)', 'success');
		}

		function showContinuePrompt() {
			log('Showing continue prompt - progress section should hide', 'info');

			// Hide progress section
			const progressSection = document.getElementById('progress-section');
			if (progressSection) {
				progressSection.style.display = 'none';
			}

			// Show continue section
			const continueSection = document.getElementById('continue-section');
			if (continueSection) {
				continueSection.style.display = 'block';
			}

			appState.isShowingContinuePrompt = true;
			log('âœ… Continue prompt shown, progress section hidden', 'success');
		}

		function hideContinuePrompt() {
			log('Hiding continue prompt', 'info');

			const continueSection = document.getElementById('continue-section');
			if (continueSection) {
				continueSection.style.display = 'none';
			}

			appState.isShowingContinuePrompt = false;
			log('âœ… Continue prompt hidden', 'success');
		}

		function handleContinue() {
			log('User chose to continue - showing progress section again', 'info');

			// Hide continue prompt
			hideContinuePrompt();

			// Show progress section again
			const progressSection = document.getElementById('progress-section');
			if (progressSection) {
				progressSection.style.display = 'block';
			}

			// Start new session
			appState.currentSession++;
			appState.totalRounds = (appState.currentSession - 1) * 20; // Reset to start of new session
			updateProgressDisplay();

			log('âœ… Progress section shown for new session', 'success');
		}

		function handleShowResults() {
			log('User chose to see results - progress section stays hidden', 'info');

			// Hide continue prompt
			hideContinuePrompt();

			// Progress section stays hidden when showing results
			log('âœ… Progress section remains hidden for results', 'success');
		}

		// Initialize
		document.addEventListener('DOMContentLoaded', function () {
			updateProgressDisplay();
			log('ðŸš€ Progress section test initialized', 'info');
		});
	</script>
</body>

</html>