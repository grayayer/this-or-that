<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Debug This or That App</title>
	<style>
		body {
			font-family: system-ui;
			padding: 20px;
		}

		.debug-section {
			margin: 20px 0;
			padding: 15px;
			border: 1px solid #ccc;
			border-radius: 5px;
		}

		.error {
			color: red;
		}

		.success {
			color: green;
		}

		.info {
			color: blue;
		}
	</style>
</head>

<body>
	<h1>Debug This or That App</h1>

	<div class="debug-section">
		<h2>Script Loading Test</h2>
		<div id="script-status"></div>
	</div>

	<div class="debug-section">
		<h2>Data Loading Test</h2>
		<div id="data-status"></div>
		<button onclick="testDataLoading()">Test Data Loading</button>
	</div>

	<div class="debug-section">
		<h2>Service Worker Test</h2>
		<div id="sw-status"></div>
		<button onclick="testServiceWorker()">Test Service Worker</button>
	</div>

	<div class="debug-section">
		<h2>Image Optimizer Test</h2>
		<div id="image-status"></div>
		<button onclick="testImageOptimizer()">Test Image Optimizer</button>
	</div>

	<!-- Load scripts in order -->
	<script src="js/image-optimizer.js"></script>
	<script src="js/data-validator.js"></script>
	<script src="js/app-data-loader.js"></script>
	<script src="js/results.js"></script>
	<script src="js/app.js"></script>
	<script src="js/timer.js"></script>
	<script src="js/email.js"></script>
	<script src="js/print.js"></script>

	<script>
		// Check script loading
		document.addEventListener('DOMContentLoaded', function () {
			const scriptStatus = document.getElementById('script-status');
			let status = '';

			// Check each required component
			const components = [
				{ name: 'ImageOptimizer', check: () => typeof imageOptimizer !== 'undefined' },
				{ name: 'DataValidator', check: () => typeof DataValidator !== 'undefined' },
				{ name: 'AppDataLoader', check: () => typeof AppDataLoader !== 'undefined' },
				{ name: 'App Functions', check: () => typeof initializeApp !== 'undefined' },
				{ name: 'Timer Functions', check: () => typeof setupTimerIntegration !== 'undefined' }
			];

			components.forEach(component => {
				const loaded = component.check();
				status += `<div class="${loaded ? 'success' : 'error'}">
                    ${component.name}: ${loaded ? '‚úÖ Loaded' : '‚ùå Not Loaded'}
                </div>`;
			});

			scriptStatus.innerHTML = status;
		});

		// Test data loading
		async function testDataLoading() {
			const statusDiv = document.getElementById('data-status');
			statusDiv.innerHTML = '<div class="info">Testing data loading...</div>';

			try {
				if (typeof AppDataLoader === 'undefined') {
					throw new Error('AppDataLoader not available');
				}

				const dataLoader = new AppDataLoader();
				const data = await dataLoader.loadDesignsWithOfflineSupport('data/sample-designs.json', {
					maxRetries: 1,
					retryDelay: 500
				});

				statusDiv.innerHTML = `
                    <div class="success">‚úÖ Data loaded successfully</div>
                    <div class="info">Designs found: ${data.designs.length}</div>
                    <div class="info">First design: ${data.designs[0].title}</div>
                `;

			} catch (error) {
				statusDiv.innerHTML = `<div class="error">‚ùå Data loading failed: ${error.message}</div>`;
				console.error('Data loading error:', error);
			}
		}

		// Test service worker
		async function testServiceWorker() {
			const statusDiv = document.getElementById('sw-status');
			statusDiv.innerHTML = '<div class="info">Testing service worker...</div>';

			try {
				if ('serviceWorker' in navigator) {
					const registration = await navigator.serviceWorker.register('/sw.js');
					statusDiv.innerHTML = `
                        <div class="success">‚úÖ Service Worker registered</div>
                        <div class="info">Scope: ${registration.scope}</div>
                    `;
				} else {
					statusDiv.innerHTML = '<div class="error">‚ùå Service Worker not supported</div>';
				}
			} catch (error) {
				statusDiv.innerHTML = `<div class="error">‚ùå Service Worker failed: ${error.message}</div>`;
				console.error('Service Worker error:', error);
			}
		}

		// Test image optimizer
		async function testImageOptimizer() {
			const statusDiv = document.getElementById('image-status');
			statusDiv.innerHTML = '<div class="info">Testing image optimizer...</div>';

			try {
				if (typeof imageOptimizer === 'undefined') {
					throw new Error('Image optimizer not available');
				}

				await imageOptimizer.init();
				const stats = imageOptimizer.getStats();

				statusDiv.innerHTML = `
                    <div class="success">‚úÖ Image Optimizer initialized</div>
                    <div class="info">WebP Support: ${stats.webpSupported}</div>
                    <div class="info">Compression Support: ${stats.compressionSupported}</div>
                `;

			} catch (error) {
				statusDiv.innerHTML = `<div class="error">‚ùå Image Optimizer failed: ${error.message}</div>`;
				console.error('Image Optimizer error:', error);
			}
		}

		// Test app initialization
		async function testAppInit() {
			try {
				console.log('üß™ Testing app initialization...');

				await initializeApp({
					dataPath: 'data/designs.json',
					fallbackDataPath: 'data/sample-designs.json',
					enableLogging: true
				});

				console.log('‚úÖ App initialization successful');

			} catch (error) {
				console.error('‚ùå App initialization failed:', error);
				alert('App initialization failed: ' + error.message);
			}
		}

		// Auto-test app initialization after a delay
		setTimeout(testAppInit, 2000);
	</script>
</body>

</html>