<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Continue Prompt Fix Test</title>
	<style>
		body {
			font-family: system-ui;
			padding: 20px;
		}

		.status {
			padding: 10px;
			margin: 10px 0;
			border-radius: 4px;
		}

		.success {
			background: #d4edda;
			color: #155724;
		}

		.error {
			background: #f8d7da;
			color: #721c24;
		}

		.info {
			background: #e3f2fd;
			color: #1565c0;
		}

		.btn {
			padding: 10px 15px;
			margin: 5px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
		}

		.btn-primary {
			background: #0066cc;
			color: white;
		}
	</style>
</head>

<body>
	<h1>Continue Prompt Fix Test</h1>
	<p>This tests that timers don't start when the continue prompt flag is set.</p>

	<div>
		<button class="btn btn-primary" onclick="testTimerBlocking()">Test Timer Blocking</button>
		<button class="btn btn-primary" onclick="clearFlag()">Clear Flag</button>
		<button class="btn btn-primary" onclick="setFlag()">Set Flag</button>
	</div>

	<div id="results"></div>

	<!-- Hidden continue section for testing -->
	<div id="continue-section" style="display: none;">Continue prompt</div>

	<script>
		// Mock app state
		window.appState = {
			isShowingContinuePrompt: false
		};

		function log(message, type = 'info') {
			const div = document.createElement('div');
			div.className = `status ${type}`;
			div.textContent = new Date().toLocaleTimeString() + ': ' + message;
			document.getElementById('results').appendChild(div);
			console.log(message);
		}

		function setFlag() {
			appState.isShowingContinuePrompt = true;
			log('âœ… Continue prompt flag set to true', 'success');
		}

		function clearFlag() {
			appState.isShowingContinuePrompt = false;
			log('âœ… Continue prompt flag set to false', 'success');
		}

		function testTimerBlocking() {
			log('ðŸ§ª Testing timer blocking logic...', 'info');

			// Simulate the timer start logic from loadNextPair
			setTimeout(() => {
				// Check if we're in continue prompt state
				if (appState.isShowingContinuePrompt) {
					log('â¸ï¸ Continue prompt state active - timer blocked!', 'success');
					return;
				}

				// Double-check that continue prompt is not showing
				const continueSection = document.getElementById('continue-section');
				if (continueSection && continueSection.style.display !== 'none') {
					log('â¸ï¸ Continue prompt is showing - timer blocked!', 'success');
					return;
				}

				log('â–¶ï¸ Timer would start normally', 'info');
			}, 500);
		}

		// Test the timeout handler logic
		function testTimeoutHandler() {
			log('ðŸ§ª Testing timeout handler logic...', 'info');

			try {
				// Check if we're in continue prompt state
				if (typeof appState !== 'undefined' && appState.isShowingContinuePrompt) {
					log('â¸ï¸ Timer expired but continue prompt state is active - not auto-advancing', 'success');
					return;
				}

				// Check if we're showing a continue prompt
				const continueSection = document.getElementById('continue-section');
				if (continueSection && continueSection.style.display !== 'none') {
					log('â¸ï¸ Timer expired but continue prompt is showing - not auto-advancing', 'success');
					return;
				}

				log('âž¡ï¸ Would advance to next pair', 'info');
			} catch (error) {
				log('âŒ Timeout handler error: ' + error.message, 'error');
			}
		}

		// Auto-test on load
		document.addEventListener('DOMContentLoaded', function () {
			log('ðŸš€ Testing with flag false (should allow timer)', 'info');
			testTimerBlocking();

			setTimeout(() => {
				log('ðŸš€ Setting flag and testing again (should block timer)', 'info');
				setFlag();
				testTimerBlocking();
			}, 1000);
		});
	</script>
</body>

</html>