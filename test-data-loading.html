<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Test Data Loading</title>
	<style>
		body {
			font-family: system-ui;
			padding: 20px;
		}

		.result {
			padding: 10px;
			margin: 10px 0;
			border-radius: 4px;
		}

		.success {
			background: #d4edda;
			color: #155724;
		}

		.error {
			background: #f8d7da;
			color: #721c24;
		}

		.info {
			background: #e3f2fd;
			color: #1565c0;
		}
	</style>
</head>

<body>
	<h1>Data Loading Test</h1>
	<div id="results"></div>

	<script src="js/data-validator.js"></script>
	<script src="js/app-data-loader.js"></script>

	<script>
		async function testDataLoading() {
			const resultsDiv = document.getElementById('results');

			try {
				resultsDiv.innerHTML += '<div class="info">🔄 Testing data loading...</div>';

				// Test basic fetch first
				const response = await fetch('data/sample-designs.json');
				if (!response.ok) {
					throw new Error(`HTTP ${response.status}: ${response.statusText}`);
				}

				resultsDiv.innerHTML += '<div class="success">✅ Basic fetch successful</div>';

				// Test with data loader
				const dataLoader = new AppDataLoader();
				const data = await dataLoader.loadDesigns('data/sample-designs.json', {
					maxRetries: 1,
					onProgress: (info) => {
						resultsDiv.innerHTML += `<div class="info">📊 ${info.message}</div>`;
					}
				});

				resultsDiv.innerHTML += `<div class="success">✅ Data loader successful</div>`;
				resultsDiv.innerHTML += `<div class="info">📈 Loaded ${data.designs.length} designs</div>`;
				resultsDiv.innerHTML += `<div class="info">🎨 First design: ${data.designs[0].title}</div>`;

				// Test app initialization
				resultsDiv.innerHTML += '<div class="info">🚀 Testing app initialization...</div>';

				// Mock the required functions for testing
				window.showLoadingState = (msg) => console.log('Loading:', msg);
				window.hideLoadingState = () => console.log('Hide loading');
				window.clearAllUIStates = () => console.log('Clear UI states');
				window.hideErrorState = () => console.log('Hide error');

				// Test the initialization
				const appState = {
					designs: [],
					isInitialized: false,
					isLoading: false,
					error: null,
					dataLoader: null,
					config: {
						dataPath: 'data/designs.json',
						fallbackDataPath: 'data/sample-designs.json',
						enableLogging: true
					}
				};

				appState.dataLoader = dataLoader;
				appState.designs = data.designs;
				appState.isInitialized = true;

				resultsDiv.innerHTML += '<div class="success">✅ App initialization successful</div>';

			} catch (error) {
				resultsDiv.innerHTML += `<div class="error">❌ Error: ${error.message}</div>`;
				console.error('Test error:', error);
			}
		}

		// Run test when page loads
		document.addEventListener('DOMContentLoaded', testDataLoading);
	</script>
</body>

</html>